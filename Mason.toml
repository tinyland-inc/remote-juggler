[brick]
name = "remote_juggler"
version = "2.3.0"
type = "application"
chplVersion = "2.6.0..2.8.0"
license = "Zlib"
authors = ["Jess Sullivan <jess@sulliwood.org>"]
repository = "https://gitlab.com/tinyland/projects/remote-juggler"
source = "https://gitlab.com/tinyland/projects/remote-juggler"
description = "Backend-agnostic git identity management with MCP/ACP agent protocol support"
keywords = ["git", "identity", "mcp", "acp", "gitlab", "github", "keychain", "gpg"]
# Compile options - Mason reads this as a single string from [brick] section
#
# KNOWN ISSUE: Mason 0.2.0 (bundled with Chapel 2.7) has a bug where ldflags
# with quoted arguments (like -framework) cannot be passed correctly through
# compopts or -- passthrough. The arguments get split on spaces, causing
# "-framework Security" to be interpreted as "-f" by chpl.
#
# WORKAROUND: Use the Makefile instead of mason build for macOS:
#   make build    # Debug build with framework linking
#   make release  # Release build with --fast
#
# The Makefile correctly passes:
#   --ldflags="-framework Security -framework CoreFoundation"
#
# For non-macOS platforms, mason build should work normally.
compopts = "-M src/remote_juggler -I c_src --permit-unhandled-module-errors"

[dependencies]
# No external dependencies - pure Chapel with C FFI for keychain

[dev-dependencies]
quickchpl = "1.0.2"

# Mason registry for quickchpl:
# Add to ~/.mason/registry/mason-registry.toml:
#   [[registry]]
#   name = "tinyland"
#   source = "https://github.com/Jesssullivan/mason-registry"
#   branch = "sid"
#
# Or use local quickchpl:
#   mason external --path /Users/jsullivan2/git/quickchpl

# C source files for keychain integration
# The Chapel compiler handles these via 'require' statements in Keychain.chpl
# Platform-specific selection:
#   - Darwin (macOS): c_src/keychain_darwin.c with -framework Security
#   - Other platforms: c_src/keychain_stub.c (no-op implementation)
#
# Build commands:
#   Darwin:  chpl -o remote-juggler src/remote_juggler.chpl -M src/remote_juggler
#   Linux:   chpl -o remote-juggler src/remote_juggler.chpl -M src/remote_juggler
#
# The require statements in Keychain.chpl handle platform-specific compilation:
#   require "keychain_darwin.c" if CHPL_TARGET_PLATFORM == "darwin";
#   require "-framework", "Security" if CHPL_TARGET_PLATFORM == "darwin";
#   require "keychain_stub.c" if CHPL_TARGET_PLATFORM != "darwin";

# Main entry point
main = "src/remote_juggler.chpl"

# Binary output name
execname = "remote-juggler"
